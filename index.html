 <!DOCTYPE html>
 <html lang="zh-cn">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

<title>数据绑定</title>
</head>
<body>
  <div id="my-app">
     <input type="text" my-model="text">
     {{data.text}}
     <div class="span" style="color: red">{{data.tt[1]}}</div>
  </div>
  </div>
</body>
<script type="text/javascript" >
    var sData = {
          data:{
            text:"哈哈",
            tt:["hello","world"],
            ss:[{yy:"dayday"},"up"]
          }
      }
    
    var MtoVTool = {
      text:function(node,jModel,strAttr){
        if(strAttr == null){
            return;
        }
        var that = this;

        strAttr.forEach(function(key){
          var copyStr = node.textContent;
          node.textContent = copyStr.replace(key,that.getValueModle(jModel,key));
        })
      },
      input:function(node,val){

      },
      getValueModle:function(jModel,strmodel){
        var reg = /\{\{(.*)\}\}/,
            regArr = /(^\w+)\[(\d)\]/,
            that = this,
            jsonNow = jModel;

        reg.test(strmodel);

        var arrKey = RegExp.$1.split(".");

        arrKey.forEach(function(key){
          //如为数组格式
          if(regArr.test(key)){
            jsonNow = jsonNow[RegExp.$1][RegExp.$2];
          }else{
            jsonNow = jsonNow[key];
          }
          
        })
        return jsonNow;
      }
    }

    //实现模版编译
    function CompileTmp(options){
      this.data = options.data;
      this.node = document.getElementById(options.ele);
      this.run();
    }

    CompileTmp.prototype = {
      run:function(){
        var flagEle = this.getNodeFragment(this.node);
        this.compileFragment(flagEle,this.data);
        this.node.appendChild(flagEle);
      },

      /* 获得文档片段
       * @arg  docnode 元素节点
       */
      getNodeFragment:function(docnode){
        var flag = document.createDocumentFragment(),
            child;
        while(child = docnode.firstChild){
          flag.appendChild(child);
        }
        return flag;
      },
       /* 获得文档片段
       * @arg  flagnode 片段节点 data 数据
       */
      compileFragment:function(flagnode,data){
        var childNodes = flagnode.childNodes,
            reg = /\{\{(\w+(\[\d\])?\.?){1,}\}\}/g, //匹配所有模版
            that = this;

         childNodes.forEach(function(node){

            //节点类型 1 元素 3 文本
            if(node.nodeType==1){
              //指令块

            }else if(node.nodeType==3){
              //数据插入
              MtoVTool.text(node,data,node.textContent.match(reg));
              
            }

            //如果有子节点 则继续渲染
            if(node.childNodes&&node.childNodes.length){
              that.compileFragment(node,data)
            }
         })
      }
    }

    var app = new CompileTmp({
      ele:"my-app",
      data:sData
    });

    // function compileHtml(node,data){
    //   var reg = /\{\{(.*)\}\}/;
    //   //节点为字符串
    //   if(node.nodeType === 3){
    //     console.log(reg.test(node.nodeValue));
    //   }
    //   //节点元素
    //   if(node.nodeType === 1){

    //   }
      
    //   // reg.text(node.v)
    // }

    // function createDocFrag(node,data){
    //   var flag = document.createDocumentFragment();
    //   var child;

    //   while(child = node.firstChild){
    //     compileHtml(child,data);
    //     //console.log(child);
    //     flag.appendChild(child);
    //     //console.log(flag);
    //   }
    //   return flag; //获得编译后文档片段
    // }
    // var myApp = function(options){
    //   this.data = options.data?options.data:{};
    //   this.ele = document.getElementById(options.ele?options.ele:"my-app");

    //   createDocFrag(this.ele,this.data)

    //   //console.log(this.ele.firstChild);
    // }
    // var app = new myApp({
    //   data:{
    //     text:"hello world"
    //   }
    // });
</script>
</html>